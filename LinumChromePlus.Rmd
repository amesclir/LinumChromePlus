---
title: "LinumChromePlus"
author: "Marcial Escudero"
date: "2/14/2022"
output: html_document
---

Setting up the data for ChromePlus with stylar condition

```{r}
#install.packages("Rtools")
#install.packages("devtools")
#library(devtools)
#install_github('coleoguy/chromePlus')
#force=TRUE
library(chromePlus)
library(diversitree)

##Chromosome number and stylar states##
#Read the tree

tree <- read.tree("Linum.tree")
tree
tree <- drop.tip(tree, "L_oligophyllum")

#Read the data

dat1 <- read.csv("Linum_StylarDataset.csv", sep=",")
dat1

#Convert data appropiate for analysis. 6 y 36 son el min y el max n de cromosomas

setdiff(tree$tip.label, dat1$Name)
setdiff(dat1$Name,tree$tip.label)

#?datatoMatrix
dat.mat <- datatoMatrix(x=dat1, range= c(6,36), hyper=T)


# make the basic likelihood function
?make.mkn
lik <- make.mkn(tree = tree, states= dat.mat, k=ncol(dat.mat), strict = F, control = list(method="ode"))

# constrain the likelihood function to a biologically realistic design
#?constrainMkn
con.lik1 <- constrainMkn(data = dat.mat,
                        lik = lik,
                        polyploidy = F,
                        hyper = T,
                        constrain = list(drop.demi = F,
                                         drop.poly= F))
con.lik2 <- constrainMkn(data = dat.mat,
                        lik = lik,
                        constrain = list(nometa = T))

# lets make sure we have the parameters we expect
#?argnames
argnames(lik)
argnames(con.lik1)
argnames(con.lik2)
#Una vez que tenemos lik y con.lik, sigo utilizando diversitree
#Crear modelos ML con "lik" y con "con.lik"

con.fit1 <- find.mle(con.lik1, rep(0.1,10), method="subplex")

con.fit2 <- find.mle(con.lik2, rep(0.1,6), method="subplex")

con.fit1$par
con.fit2$par
anova(con.fit1, constrained=con.fit2)

```



Setting up the data for ChromePlus with distribution
```{r}


##Chromosome number and distribution##

#Read the tree

tree <- read.tree("Linum.tree")
tree
tree <- drop.tip(tree, "L_oligophyllum")

#Read the data

dat2 <- read.csv("Linum_distributionDataset.csv", sep=",")
dat2

#Convert data appropiate for analysis. 6 y 36 son el min y el max n de cromosomas

setdiff(tree$tip.label, dat2$Name)
setdiff(dat2$Name,tree$tip.label)

?datatoMatrix
dat.mat2 <- datatoMatrix(x=dat2, range= c(6,36), hyper=T)


# make the basic likelihood function

?is.ultrametric
is.ultrametric(tree)

?make.mkn

lik <- make.mkn(tree = tree, states= dat.mat2, k=ncol(dat.mat2), strict = F, control = list(method="ode"))


# constrain the likelihood function to a biologically realistic design

?constrainMkn

con.lik3 <- constrainMkn(data = dat.mat2,
                        lik = lik,
                        polyploidy = F,
                        hyper = T,
                        constrain = list(drop.demi = F,
                                         drop.poly= F))


con.lik4 <- constrainMkn(data = dat.mat2,
                        lik = lik,
                        constrain = list(nometa = T))

# lets make sure we have the parameters we expect
#?argnames
argnames(lik)
argnames(con.lik3)
argnames(con.lik4)
#Una vez que tenemos lik y con.lik, sigo utilizando diversitree
#Crear modelos ML con "lik" y con "con.lik"

con.fit3 <- find.mle(con.lik3, rep(0.1,10), method="subplex")

con.fit4 <- find.mle(con.lik4, rep(0.1,6), method="subplex")

con.fit3$par
con.fit4$par

anova(con.fit3, constrained=con.fit4)

```

